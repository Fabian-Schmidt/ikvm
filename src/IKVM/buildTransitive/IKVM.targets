<Project>
    <PropertyGroup>
        <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
    </PropertyGroup>

    <Target Name="ResolveIkvmRuntimeIdentifier">
        <IkvmResolveNearestRuntimeIdentifier AvailableRuntimeIdentifiers="@(IkvmAvailableRuntimeIdentifiers, ';')" TargetRuntimeIdentifier="$(RuntimeIdentifier)">
            <Output TaskParameter="NearestRuntimeIdentifier" PropertyName="_IkvmRuntimeIdentifier" />
        </IkvmResolveNearestRuntimeIdentifier>
        <ItemGroup>
            <_IkvmRuntimeIdentifiers Include="$(_IkvmRuntimeIdentifier)" />
            <_IkvmRuntimeIdentifiers Include="@(IkvmAvailableRuntimeIdentifiers)" Condition=" '@(_IkvmRuntimeIdentifiers)' == '' " />
        </ItemGroup>
    </Target>

    <Target Name="IncludeIkvmNativeLibraries" BeforeTargets="AssignTargetPaths">
        <ItemGroup Condition="$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'net461'))">
            <_IkvmNativeLibraries Include="$(MSBuildThisFileDirectory)..\runtimes\**\native\*.dll" />
            <None Include="@(_IkvmNativeLibraries)">
                <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
                <TargetPath>runtimes\%(RecursiveDir)native\%(Filename)%(Extension)</TargetPath>
            </None>
        </ItemGroup>
    </Target>

    <Import Project="IKVM.IkvmReference.targets" />
</Project>
