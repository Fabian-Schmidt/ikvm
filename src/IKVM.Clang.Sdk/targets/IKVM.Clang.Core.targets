<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
    </PropertyGroup>

    <PropertyGroup>
        <OutputType>$(OutputType.ToLower())</OutputType>
    </PropertyGroup>

    <PropertyGroup>
        <Platform Condition="'$(Platform)' == ''">AnyCPU</Platform>
        <PlatformName Condition="'$(PlatformName)' == ''">$(Platform)</PlatformName>
        <Configuration Condition="'$(Configuration)' == ''">Debug</Configuration>
        <ConfigurationName Condition="'$(ConfigurationName)' == ''">$(Configuration)</ConfigurationName>

        <BaseOutputPath Condition=" '$(BaseOutputPath)' == '' ">bin\</BaseOutputPath>
        <BaseOutputPath Condition="!HasTrailingSlash('$(BaseOutputPath)')">$(BaseOutputPath)\</BaseOutputPath>
        <OutputPath Condition=" '$(OutputPath)' == '' ">$(BaseOutputPath)$(Configuration)\$(TargetMachine)\</OutputPath>
        <OutputPath Condition="!HasTrailingSlash('$(OutputPath)')">$(OutputPath)\</OutputPath>

        <BaseIntermediateOutputPath Condition="'$(BaseIntermediateOutputPath)' == ''">obj\</BaseIntermediateOutputPath>
        <BaseIntermediateOutputPath Condition="!HasTrailingSlash('$(BaseIntermediateOutputPath)')">$(BaseIntermediateOutputPath)\</BaseIntermediateOutputPath>
        <IntermediateOutputPath Condition=" '$(IntermediateOutputPath)' == '' ">$(BaseIntermediateOutputPath)$(Configuration)\$(TargetMachine)</IntermediateOutputPath>
        <IntermediateOutputPath Condition="!HasTrailingSlash('$(IntermediateOutputPath)')">$(IntermediateOutputPath)\</IntermediateOutputPath>
    </PropertyGroup>

    <PropertyGroup>
        <DebugSymbols Condition=" '$(ConfigurationName)' == 'Debug' and '$(DebugSymbols)' == '' and '$(DebugType)'==''">true</DebugSymbols>
    </PropertyGroup>

    <PropertyGroup>
        <TargetExt Condition="'$(TargetExt)' == '' and '$(OutputType)'=='exe'">.exe</TargetExt>
        <TargetExt Condition="'$(TargetExt)' == '' and '$(OutputType)'=='winexe'">.exe</TargetExt>
        <TargetExt Condition="'$(TargetExt)' == '' and '$(OutputType)'=='library'">.dll</TargetExt>
    </PropertyGroup>

    <PropertyGroup>
        <ProjectName Condition=" '$(ProjectName)' == '' ">$(MSBuildProjectName)</ProjectName>
        <TargetName Condition=" '$(TargetName)' == '' ">$(ProjectName)</TargetName>
        <ProjectFileName Condition=" '$(ProjectFileName)' == '' ">$(MSBuildProjectFile)</ProjectFileName>
        <ProjectExt Condition=" '$(ProjectExt)' == '' ">$(MSBuildProjectExtension)</ProjectExt>
        <TargetFileName Condition=" '$(TargetFileName)' == '' ">$(TargetName)$(TargetExt)</TargetFileName>
        <TargetPath Condition=" '$(TargetPath)' == '' ">$(IntermediateOutputPath)$(TargetFileName)</TargetPath>
    </PropertyGroup>

    <PropertyGroup>
        <GetTargetPathDependsOn>
            $(GetTargetPathDependsOn)
        </GetTargetPathDependsOn>
    </PropertyGroup>

    <Target Name="GetTargetPath" DependsOnTargets="$(GetTargetPathDependsOn)" Returns="@(TargetPath)">
        <ItemGroup>
            <TargetPath Include="$(TargetPath)" />
        </ItemGroup>
    </Target>

    <PropertyGroup>
        <PreBuildEventDependsOn></PreBuildEventDependsOn>
        <PostBuildEventDependsOn></PostBuildEventDependsOn>
    </PropertyGroup>

    <Target
        Name="PreBuildEvent"
        Condition="'$(PreBuildEvent)'!=''"
        DependsOnTargets="$(PreBuildEventDependsOn)">

        <Exec WorkingDirectory="$(OutDir)" Command="$(PreBuildEvent)" />
    </Target>

    <Target
        Name="PostBuildEvent"
        Condition="'$(PostBuildEvent)'!=''"
        DependsOnTargets="$(PostBuildEventDependsOn)">

        <Exec WorkingDirectory="$(OutDir)" Command="$(PostBuildEvent)" />
    </Target>

    <PropertyGroup>
        <BuildDependsOn>
            BeforeBuild;
            CoreBuild;
            AfterBuild
        </BuildDependsOn>
    </PropertyGroup>

    <Target Name="Build" Condition=" '$(_InvalidConfigurationWarning)' != 'true' " DependsOnTargets="$(BuildDependsOn)" Returns="@(TargetPath)" />

    <Target Name="BeforeBuild"/>

    <Target Name="AfterBuild"/>

    <PropertyGroup>
        <CoreBuildDependsOn>
            PreBuildEvent;
            Compile;
            GetTargetPath;
            PostBuildEvent
        </CoreBuildDependsOn>
    </PropertyGroup>

    <Target Name="CoreBuild" DependsOnTargets="$(CoreBuildDependsOn)">
        <OnError ExecuteTargets="_TimeStampAfterCompile;PostBuildEvent" Condition="'$(RunPostBuildEvent)'=='Always' or '$(RunPostBuildEvent)'=='OnOutputUpdated'"/>
    </Target>

    <PropertyGroup>
        <_ProjectDefaultTargets Condition="'$(MSBuildProjectDefaultTargets)' != ''">$(MSBuildProjectDefaultTargets)</_ProjectDefaultTargets>
        <_ProjectDefaultTargets Condition="'$(MSBuildProjectDefaultTargets)' == ''">Build</_ProjectDefaultTargets>

        <RebuildDependsOn>
            BeforeRebuild;
            Clean;
            $(_ProjectDefaultTargets);
            AfterRebuild;
        </RebuildDependsOn>

        <RebuildDependsOn Condition=" '$(MSBuildProjectDefaultTargets)' == 'Rebuild' " >
            BeforeRebuild;
            Clean;
            Build;
            AfterRebuild;
        </RebuildDependsOn>
    </PropertyGroup>

    <Target Name="Rebuild" Condition=" '$(_InvalidConfigurationWarning)' != 'true' " DependsOnTargets="$(RebuildDependsOn)" Returns="$(TargetPath)"/>

    <Target Name="BeforeRebuild"/>

    <Target Name="AfterRebuild"/>

    <PropertyGroup>
        <CompileDependsOn>
            BeforeCompile;
            CoreCompile;
            AfterCompile;
        </CompileDependsOn>
    </PropertyGroup>

    <Target Name="Compile" DependsOnTargets="$(CompileDependsOn)"/>

    <Target Name="BeforeCompile" />

    <Target Name="AfterCompile" />

    <Target Name="CoreCompile">
        <MakeDir Directories="$(IntermediateOutputPath)" />

        <ItemGroup>
            <_Args Include="-v" Condition=" '$(Verbose)' == 'true' " />
            <_Args Include="--target=$(TargetMachine)" />
            <_Args Include="-shared" Condition=" '$(OutputType)' == 'library' " />
            <_Args Include="-std=$(LanguageStandard)" Condition=" '$(LanguageStandard)' != '' " />
            <_Args Include="-fms-compatibility" Condition=" '$(MsCompatibility)' == 'true' " />
            <_AdditionalIncludeDirectories Include="@(AdditionalIncludeDirectories)" />
            <_AdditionalIncludeDirectories Include="$(AdditionalIncludeDirectories)" />
            <_Args Include="@(_AdditionalIncludeDirectories->'-I%(Identity)')" Condition=" '@(_AdditionalIncludeDirectories)' != '' " />
            <_AdditionalLibraryDirectories Include="@(AdditionalLibraryDirectories)" />
            <_AdditionalLibraryDirectories Include="$(AdditionalLibraryDirectories)" />
            <_Args Include="@(_AdditionalLibraryDirectories->'-L%(Identity)')" Condition=" '@(_AdditionalLibraryDirectories)' != '' " />
            <_AdditionalDependencies Include="@(AdditionalDependencies)" />
            <_AdditionalDependencies Include="$(AdditionalDependencies)" />
            <_Args Include="@(_AdditionalDependencies->'-l%(Identity)')" Condition=" '@(_AdditionalDependencies)' != '' " />
            <_PreprocessorDefinitions Include="$(PreprocessorDefinitions)" />
            <_Args Include="@(_PreprocessorDefinitions->'-D%(Identity)')" Condition=" '@(_PreprocessorDefinitions)' != '' " />
            <_Args Include="-fuse-ld=$(UseLd)" Condition=" '$(UseLd)' != '' " />
            <_Args Include="@(Include->'-I%(Identity)')" />
            <_Args Include="$(AdditionalOptions)" Condition=" '$(AdditionalOptions)' != '' " />
            <_Args Include="@(Compile->'%(Identity)')" />
            <_Args Include="-o $(TargetPath)" />
        </ItemGroup>
        
        <Exec Command="clang @(_Args, ' ')" />
    </Target>

</Project>
